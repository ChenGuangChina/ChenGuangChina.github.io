---
layout: post
title: IP详解
date: 2018-02-05 15:50:00.000000000 +09:00
tags: 躬行集
---

今天在想是不是可以做一个去中心化的聊天应用，手机即为客户端也为服务端，数据全部在自己手上，数据加密后避开所有监管和检查。调研发现手机的4G网络分配的IP是内网IP，只能做局域网聊天应用。但猜测在同一个城市应该属于同一个局域网，也许可以实现同城同运营商下的去中心化聊天。
顺便补了下IP的知识。
## IP协议版本
目前的全球因特网所采用的协议族是TCP/IP协议族。IP是TCP/IP协议族中网络层的协议，是TCP/IP协议族的核心协议。目前IP协议的版本号是4(简称为IPv4)，发展至今已经使用了30多年。IPv4的地址位数为32位，也就是最多有2的32次方的电脑可以联到Internet上。

近十年来由于互联网的蓬勃发展，IP位址的需求量愈来愈大，IPV4地址将耗尽（上文中的运营商建的大局域网，应该很大程度上缓解了IP地址耗尽的情况）。

什么是IPv6?  
IPv6是下一版本的互联网协议，也可以说是下一代互联网的协议，它的提出最初是因为随着互联网的迅速发展，IPv4定义的有限地址空间将被耗尽，地址空间的不足必将妨碍互联网的进一步发展。为了扩大地址空间，拟通过IPv6重新定义地址空间。IPv6采用128位地址长度，几乎可以不受限制地提供地址。按保守方法估算IPv6实际可分配的地址，整个地球的每平方米面积上仍可分配1000多个地址。在IPv6的设计过程中除了一劳永逸地解决了地址短缺问题以外，还考虑了在IPv4中解决不好的其它问题，主要有端到端IP连接、服务质量（QoS）、安全性、多播、移动性、即插即用等。

IPv6与IPv4相比有什么特点和优点？  
更大的地址空间。IPv4中规定IP地址长度为32，即有2^32-1个地址；而IPv6中IP地址的长度为128，即有2^128-1个地址。  
更小的路由表。  
更高的安全性。  
等等....

个人在开发实践中发现国内对IPV6的支持还很弱...从美国发起的IPV6请求，中国很多节点不能正确解析。
## IPV4详解
IPv4地址使用32位二进制数格式，通常使用点分十进制数来表示，如202.101.123.21,对应的二进制数就是(11001010.01100101.01111011.00010101)

一个IPv4地址主要有两部分组成：一部分用于标识该地址所属网络号，一部分用于标识该网络中某个特定主机。
### IPV4将IP地址分为5类：
*保留IP：每个网络中可容纳的主机数是理论主机数减2，因为有两个地址被保留：  
网络地址——网络位不变，主机位全0的地址，表示网路本身。  
广播地址——网络位不变，主机位全1的地址，表示本网络的广播。  

A类：前8位用来标识网络号，后24位用来标识主机号。第一个字的十进制范围为1-126。  
B类：前16位用来标识网络号，后16位用来标识主机。第一个字的十进制范围为：128-191。  
C类：前24位用来标识网络号，后8位用来标识主机。第一个字的十进制范围为192-223。  
D类：组播地址。第一个字十进制范围224-239，共2^28个。  
E类：科研保留地址。从240-255，共2^28个。  

私有IP地址作为内部组网使用：  
A类：10.0.0.0 ~ 10.255.255.255  
B类：172.16.0.0 ~ 172.31.255.255   
C类：192.1688.0.0 ~ 192.168.255.255   
## 其它
### 子网掩码
32位的IP地址，通过子网掩码来划分网络位和主机位。  
如果一个IP地址中,前24位代表子网号，后8位代表主机号。  
那么它的子网掩码就是24个1(代表前24位是子网部分),加8个0(后8 位是主机部分)。沿用IP的十进制表示方式就是 255.255.255.0。

同一个网络地址的两台主机可以直接通信，不同的需要路由转发。
### 网关
网关实质上是一个网络通向其他网络的IP地址。(具有路由功能的设备的IP)  
由于分别处于两个子网下的IP地址不能直接通信。两个网络间的通信就必须要通过网关。  

比如有网络A和网络B，网络A的IP地址范围为“192.168.1.1~192. 168.1.254”，子网掩码为255.255.255.0；网络B的IP地址范围为“192.168.2.1~192.168.2.254”，子网掩码为255.255.255.0。在没有路由器的情况下，两个网络之间是不能进行TCP/IP通信的，即使是两个网络连接在同一台交换机（或集线器）上，TCP/IP协议也会根据子网掩码（255.255.255.0）判定两个网络中的主机处在不同的网络里。如果网络A中的主机发现数据包的目的主机不在本地网络中，就把数据包转发给它自己的网关，再由网关转发给网络B的网关，网络B的网关再转发给网络B的某个主机。

